document.addEventListener('DOMContentLoaded', function() {
  const PROXY_URL = 'https://script.google.com/macros/s/AKfycbxO1sAX3rEDqaxe3C54I8wOEzvfEarLoQNm0xNjTxmYjjnLlTalc0CAVYqps8dO_elHVQ/exec';
  const CHANNEL_ID = 'UC_yjveGdyx6mqqHkHaD-_bg';
  const playlistContainer = document.getElementById('playlist-gallery');
  const videoContainer = document.getElementById('video-gallery');

  fetch(`${PROXY_URL}?channelId=${CHANNEL_ID}`)
    .then(response => response.json())
    .then(data => {
      if (!data.items) {
        playlistContainer.innerHTML = '<p>No playlists found.</p>';
        return;
      }
      playlistContainer.innerHTML = '';
      data.items.forEach(item => {
        const playlistId = item.id;
        const thumb = item.snippet.thumbnails.medium.url;
        const title = item.snippet.title;

        const div = document.createElement('div');
        div.style.width = '300px';
        div.style.textAlign = 'center';
        div.style.backgroundColor = '#fff';
        div.style.padding = '10px';
        div.style.borderRadius = '8px';
        div.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
        div.style.cursor = 'pointer';
        div.innerHTML = `
          ${thumb}
          <p style="color:#333;font-size:16px;margin-top:10px;font-weight:500;">${title}</p>
        `;
        div.onclick = () => loadPlaylistVideos(playlistId);
        playlistContainer.appendChild(div);
      });
    })
    .catch(error => {
      console.error('Error fetching playlists:', error);
      playlistContainer.innerHTML = '<p>Error loading playlists.</p>';
    });

  function loadPlaylistVideos(playlistId) {
    videoContainer.innerHTML = '<p>Loading videos...</p>';
    fetch(`${PROXY_URL}?playlistId=${playlistId}`)
      .then(response => response.json())
      .then(data => {
        videoContainer.innerHTML = '';
        if (!data.items) {
          videoContainer.innerHTML = '<p>No videos found.</p>';
          return;
        }
        data.items.forEach(item => {
          const videoId = item.snippet.resourceId.videoId;
          const thumb = item.snippet.thumbnails.medium.url;
          const title = item.snippet.title;

          const div = document.createElement('div');
          div.style.width = '300px';
          div.style.textAlign = 'center';
          div.style.backgroundColor = '#fff';
          div.style.padding = '10px';
          div.style.borderRadius = '8px';
          div.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
          div.style.cursor = 'pointer';
          div.innerHTML = `
            ${thumb}
            <p style="color:#333;font-size:16px;margin-top:10px;font-weight:500;">${title}</p>
          `;
          div.onclick = () => openVideo(videoId);
          videoContainer.appendChild(div);
        });
      })
      .catch(error => {
        console.error('Error fetching videos:', error);
        videoContainer.innerHTML = '<p>Error loading videos.</p>';
      });
  }
});

function openVideo(videoId) {
  const modal = document.createElement('div');
  modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;justify-content:center;align-items:center;z-index:9999;';
  modal.innerHTML = `
    <div style="position:relative;width:80%;max-width:800px;">
      https://www.youtube.com/embed/${videoId}?autoplay=1
      <button onclick="document.body.removeChild(this.parentNode.parentNode)" style="position:absolute;top:10px;right:10px;background:#fff;border:none;padding:10px;cursor:pointer;">Close</button>
    </div>
  `;
  document.body.appendChild(modal);
}
